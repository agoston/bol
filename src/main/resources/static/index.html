<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>Lubang Menggali</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="game.css"/>
    <script src="jquery-2.1.1.min.js"></script>

    <script charset="utf-8">

        var player = {};
        var opponent = {};
        var match = {};

        $(function () {
            $("input.login:button").click(function (e) {
                player.name = $("input.login:text").val();
                $.ajax({
                    url: "/player?name=" + player.name,
                    type: "POST",
                    success: function (data, textStatus, jqXHR) {
                        console.log(data);
                        player.id = data.id;
                        $("div.login").fadeOut(400, function() {
                            startMatch();
                            $("div.board").fadeIn(400);
                        });
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown);
                    }
                });
                e.preventDefault();
            });
        });

        function startMatch() {
            $.ajax({
                url: "/player/" + player.id + "/match",
                type: "POST",
                success: function (data, textStatus, jqXHR) {
                    console.log(data);
                    if (jqXHR.status == 202) {
                        window.setTimeout(startMatch, 1000);
                        return;
                    }
                    match = data;
                    drawBoard();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });

            function drawBoard() {
                var boardSelector = $("div.board");

                for (var i = 0; i < 2; i++) {
                    for (var j = 0; j < 6; j++) {
                        var newDiv = document.createElement('div');
                        $(newDiv).css({
                            position: "absolute",
                            left: (100 + j*50) + "px",
                            top: (100 + i*50) + "px",
                            width: "40px",
                            height: "40px",
                            margin: "5px",
                            "color": "#fff",
                            "background-color": (i==0?"#b00000":"#00b000"),
                            "text-shadow": "2px 2px 2px #000",
                            "text-align": "center",
                            "line-height": "40px"
                        });
                        newDiv.innerHTML = match.pits[i][j];
                        $(newDiv).appendTo(boardSelector);
                    }
                }
            }
        }

    </script>
</head>
<body>

<div class="login">
You are: <input type="text" class="login" name="name" value="Anonymous"/><input type="button" value="Start!" class="login"/>
</div>

<div class="board"/>

</body>
